---
title: API Reference

language_tabs: # must be one of https://git.io/vQNgJ
  - shell
  - ruby
  - python
  - javascript

toc_footers:
  - <a href='#'>Sign Up for a Developer Key</a>
  - <a href='https://github.com/lord/slate'>Documentation Powered by Slate</a>

includes:
  - errors

search: true
---

# Introduction

Welcome to Wapipay APIs! In this release, we have exposed API endpoints for accessing Wapipay services; we have Wapipay API endpoints for B2C, and C2B. Our APIs are built on REST; data entities are represented as HTTP resources and are accessed using HTTP verbs, majorly GET and POST. API request parameters and responses - including errors - are encoded in JSON. Our APIs response status codes and error codes comply with HTTP status codes as defined in RFC 2616. You can invoke our API endpoints using REST clients like Postman or SoapUI and command line tools like cUrl and Node.js.

To get you started, we have provided code samples in curl, Ruby, PHP, Python, NodeJS, and Java! Sample JSON responses for each APIs request have also been availed. You can view the code examples to the right, and you can switch between the programming languages with the tabs on the top right.


## Getting Started

### Developer Sign-up
To use our APIs or invoke an API endpoint, you will need to register for an account. Available accounts are Global Remitance Merchant. Users intending to apply for an M-Pesa shortcode can also register with a company account.

An account activation link will be sent in an email to the email address you used in registering for a developer account; the activation link expires within 24 hours of it being sent, and you will need to register for another account. The account activation link enables you to activate your developer account and set a password for your account.

### Creating a Sandbox App

The first time you log in into your developer account, after account activation, the sandbox apps page opens from which you can create an app by clicking

Creating an app involves setting an app name and choosing the API products for which you will want to use. API products are a business package of the available APIs and the rules for access built around them.

### App Dashboard

Once you have created an app, a dashboard from which you can view details about the app(s) you have created. Clicking on an app reveals tabs with more information about the app; the tabs are Keys, Products, Details, Edit and Delete.

### App Dashboard
Once you have created an app, a dashboard from which you can view details about the app(s) you have created. Clicking on an app reveals tabs with more information about the app; the tabs are Keys, Products, Details, Edit and Delete.

### Keys
The app keys of an app are the consumer key and consumer secret. The Keys tab shows the app keys, the date they were issued and their expiry period. Sandbox keys do not expire.

### Products
A product is an encapsulation of an API(s) with access rules and business rules around their use. The use case of an app the developer is building should be guided by an API product. Access rules involve the traffic generated by the app.

### Details
The details tab gives you a summary of the details about your app and the terms and conditions for accessing the sandbox.

### Analytics
From the analytics tab, you can gauge how you can gauge how your app is performing over a period of time - day, week(s) or month(s). We provide app analytics for throughput, maximum response time, minimum response time, endpoint response time, message count and error count

### Edit
Should you need to change details about your app, like its name or API products, then you can do so in the Edit tab.

### Delete
This delete tab, destroys your app and removes it from your dashboard.


# Authentication
```ruby
library(RCurl)
headers = c(
  "Authorization" = "Basic RDdmWnVkWDAyYWgwTnFMTG5pelVIb3pDRjlva1Jpelk6SGlpUnFnR2lkSUNhMm5xbg=="
)
res <- getURL("localhost:8081/wapipay/oauth/v1/generate?grant_type=client_credentials", .opts=list(httpheader = headers, followlocation = TRUE))
cat(res)
```

```python
import requests

url = "localhost:8081/wapipay/oauth/v1/generate?grant_type=client_credentials"

payload={}
headers = {
  'Authorization': 'Basic RDdmWnVkWDAyYWgwTnFMTG5pelVIb3pDRjlva1Jpelk6SGlpUnFnR2lkSUNhMm5xbg=='
}

response = requests.request("GET", url, headers=headers, data=payload)

print(response.text)
```

```shell
curl -X GET https://sandbox.safaricom.co.ke/oauth/v1/generate?grant_type=client_credentials  \
  -H "Accept: application/json" \
  -u "YOUR_APP_CONSUMER_KEY:YOUR_APP_CONSUMER_SECRET"
```

```javascript
var myHeaders = new Headers();
myHeaders.append("Authorization", "Basic RDdmWnVkWDAyYWgwTnFMTG5pelVIb3pDRjlva1Jpelk6SGlpUnFnR2lkSUNhMm5xbg==");

var requestOptions = {
  method: 'GET',
  headers: myHeaders,
  redirect: 'follow'
};

fetch("localhost:8081/wapipay/oauth/v1/generate?grant_type=client_credentials", requestOptions)
  .then(response => response.text())
  .then(result => console.log(result))
  .catch(error => console.log('error', error));
```

> The above command returns JSON structured like this:

```json
{
  "access_token": "SGWcJPtNtYNPGm6uSYR9yPYrAI3Bm",
  "expires_in": "3599"
}
```
To make an API call, you will need to authenticate your app. We have provided an OAuth API for you to generate an access token, we support client_credentials grant type. To authorize your API call to the OAuth API, you will need a Basic Auth over HTTPS authorization token. The Basic Auth string is a base64 encoded string of your app’s client key and client secret.

The OAuth access token expires after an hour, after which, you will need to generate another access token. On a production app, use a base64 library of the programming language you are using to build your app to get the Basic Auth string that you will then use to invoke our OAuth API to get an access token.

# HTTP Header Parameters

With an OAuth 2.0 Access Token, an application can now invoke our APIs by including the access token in the HTTP header. Our APIs currently only supports `application/json` content type.

Parameter | Description
--------- | ---------
Authorization | OAuth 2.0 Access Token. Bearer keyword followed by a space and the OAuth 2.0 Access Token. `Bearer <Access-Token>`
Content-Type | Only `application/json` content type is supported.

# Wapipay Response Codes
Response codes are sent from the clients endpoints back to the gateway. This is done to acknowledge that the client has received the results.

Result Code | Description
--------- | --------- 
0 | Success (for C2B)
00000000 | Success (For APIs that are not C2B)
1 or any other number | Rejecting the transaction

# Wapipay APIs
The following are the M-Pesa APIs that are available to test. This documentation provides sample codes and JSON responses to the right with these APIs.

A Postman collection of these APIs are also available.

## B2C API

```ruby
library(httr)

headers = c(
  'Authorization' = 'Bearer d823e604-9e25-46f9-a086-b0f1ed18bc50',
  'Content-Type' = 'application/json'
)

body = '{
  "amount": 15,
  "remarks": "Bet cash out",
  "occasion": "Won promo 332HDV4F",
  "recipient": "254712761593"
}';

res <- VERB("POST", url = "https://api.wapipay.com/wapipay/api/v1/b2c/payment_request", body = body, add_headers(headers))

cat(content(res, 'text'))
```

```python
import requests
import json

url = "https://api.wapipay.com/wapipay/api/v1/b2c/payment_request"

payload = json.dumps({
  "amount": 15,
  "remarks": "Bet cash out",
  "occasion": "Won promo 332HDV4F",
  "recipient": "254712761593"
})
headers = {
  'Authorization': 'Bearer d823e604-9e25-46f9-a086-b0f1ed18bc50',
  'Content-Type': 'application/json'
}

response = requests.request("POST", url, headers=headers, data=payload)

print(response.text)
```

```shell
curl --location --request POST 'https://api.wapipay.com/wapipay/api/v1/b2c/payment_request' \
--header 'Authorization: Bearer d823e604-9e25-46f9-a086-b0f1ed18bc50' \
--header 'Content-Type: application/json' \
--data-raw '{
    "amount": 15,
    "remarks": "Bet cash out",
    "occasion": "Won promo 332HDV4F",
    "recipient": "254712761593"
}'
```

```javascript
var myHeaders = new Headers();
myHeaders.append("Authorization", "Bearer d823e604-9e25-46f9-a086-b0f1ed18bc50");
myHeaders.append("Content-Type", "application/json");

var raw = JSON.stringify({
  "amount": 15,
  "remarks": "Bet cash out",
  "occasion": "Won promo 332HDV4F",
  "recipient": "254712761593"
});

var requestOptions = {
  method: 'POST',
  headers: myHeaders,
  body: raw,
  redirect: 'follow'
};

fetch("https://api.wapipay.com/wapipay/api/v1/b2c/payment_request", requestOptions)
  .then(response => response.text())
  .then(result => console.log(result))
  .catch(error => console.log('error', error));
```

> The above command returns JSON structured like this:

```json
[
  {
    "id": 1,
    "name": "Fluffums",
    "breed": "calico",
    "fluffiness": 6,
    "cuteness": 7
  },
  {
    "id": 2,
    "name": "Max",
    "breed": "unknown",
    "fluffiness": 5,
    "cuteness": 10
  }
]
```

This API enables Business to Customer (B2C) transactions between a company and customers who are the end-users of its products or services. Use of this API requires a valid and verified B2C M-Pesa Short code.

### HTTP Request

`POST https://api.wapipay.com/wapipay/api/v1/b2c/payment_request`

### Query Parameters

Parameter | Description
--------- | ---------
amount | The amount being transacted
recipient | Phone number receiving the transaction
remarks | Comments that are sent along with the transaction.
occasion | Optional

<aside class="success">
Remember — a B2C is an authenticated!
</aside>

